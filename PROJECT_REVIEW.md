# Проверка проекта MeowNoMeow

## Выполненные оптимизации

### 1. Удалены неиспользуемые библиотеки
- **beautifulsoup4** — не использовалась (парсер на Playwright)
- **lxml** — не использовалась
- **alembic** — не использовался (миграции в `database_init.py`)

### 2. Удалён мёртвый код
- Метод `_log()` и `log_path` в парсере — нигде не вызывались
- Импорт `json` — использовался только в `_log`

### 3. Ускорение парсера
- `wait_until="networkidle"` → `"domcontentloaded"` (быстрее загрузка)
- Таймауты: 3000→2000, 2000→1500, 1000→800, 400→300 мс
- Диапазон: 5 недель → 3 недели (1 назад, 2 вперёд)

### 4. Оптимизация планировщика
- После планирования уведомлений статус `created`/`changed` → `active`
- Повторная обработка тех же записей при каждой синхронизации исключена

## Текущие зависимости (только необходимые)

| Пакет | Назначение |
|-------|------------|
| aiogram | Telegram-бот |
| aiohttp | Зависимость aiogram |
| aiosqlite | SQLite async |
| asyncpg | PostgreSQL (для production) |
| sqlalchemy | ORM БД |
| python-dotenv | Переменные окружения |
| apscheduler | Планировщик синхронизации |
| playwright | Парсинг Dikidi (браузер) |

## Данные в БД — что сохраняется

**Appointment** (только необходимое):
- event, date, time, master — для отображения
- clientlink — ссылка на запись
- visit_status — состояние из Dikidi
- user_id, company_id — связь с пользователем

**НЕ сохраняем** (есть в парсере, но не нужно):
- client_name — не требуется в боте
- day_of_week — дублирует date
- duration — не используется

## Проверка работоспособности

```bash
# Запуск бота
python main.py

# Диагностика парсера и БД
python check_parser_db.py

# Сброс БД
python reset_db.py
```
